앞서 말한 
- 컨테이너가 루트 권한을 사용
- 컨테이너와 호스트의 포트 공유
- 컨테이너에서 호스트의 프로세스 관찰가능 등등..
의 문제들을 해결하기 위해

mount namespace 이후에 여러 공유들을 분리시키는 새로운 네임스페이스들이 개발되었다 
<img width="1528" alt="image" src="https://github.com/dik654/Kubernetes_study/assets/33992354/0d9ac811-2b39-48f3-836d-43977c6f7936">

<br/><br/>

## UTS(unix time sharing) namespace
이는 새로 생성한 컨테이너가 항상 부모의 호스트명, 도메인명을 상속하기에, 이를 분리하기 위해 사용한다
<img width="782" alt="image" src="https://github.com/dik654/Kubernetes_study/assets/33992354/644a5091-3654-4212-9589-eb937055d21a">

<br/><br/>

## IPC namespace
프로세스간의 통신을 위한 IPC를 분리하여 네임스페이스 바깥의 프로세스와 통신이 단절된다
<img width="1176" alt="image" src="https://github.com/dik654/Kubernetes_study/assets/33992354/7d031e62-b0aa-4878-8898-77ed34437ed4">

## PID namespace
child PID namespace는 root PID namespace를 fork하여<br/>
child 내부에서는 root PID를 확인할 수 없는 상태가 된다<br/>
<img width="871" alt="image" src="https://github.com/dik654/Kubernetes_study/assets/33992354/82931a2b-dd00-41d0-9c42-ec1330925499">

pid 1번은 
- 시그널 처리
- 좀비, 고아 프로세스 처리

같은 역할을 하는데 PID namespace 생성 시 프로세스를 fork하여 컨테이너 내부에서 PID 1번으로 동작하게 한다<br/>
root에서 PID 1번처럼, 컨테이너의 PID 1번이 종료될 경우 컨테이너도 종료된다 
<img width="715" alt="image" src="https://github.com/dik654/Kubernetes_study/assets/33992354/e72fbf11-910e-4484-a116-2bdf3a8f250c">

<br/><br/>

## network namespace
네트워크 가상화를 통해 root와 child namespace들 간의 네트워크를 분리시킨다<br/>
<img width="815" alt="image" src="https://github.com/dik654/Kubernetes_study/assets/33992354/9bca8af8-1f81-48bc-98dc-eee0c42be2a0">

이렇게 namespace에 가상화 된 네트워크 장치는 다른 namespace에 물리 장치처럼 1대1로 연결하는 것이 가능하다
<img width="874" alt="image" src="https://github.com/dik654/Kubernetes_study/assets/33992354/eb0d6098-d1ed-4521-86b8-101844ca5be8">

<br/><br/>

## user namespace
chroot가 마운트된 디렉터리를 root로 속였다면<br/>
user namespace는 root 시스템에서 일반적인 UID를<br/>
namespace안에서 0으로 다시 매핑시켜 namespace에서의 사용자가 root라고 착각하게 만든다<br/>
따라서 child namespace에서 root로 실행됐던 프로세스가 root namespace에서는 일반 계정으로 실행된다 
<img width="907" alt="image" src="https://github.com/dik654/Kubernetes_study/assets/33992354/2d29d3fc-8c55-49bb-8e5a-550d1cf788d6">

<br/><br/>

## Cgroup
cpu, memory등을 파일 시스템으로 관리하여 namespace가 할당된 일부분의 자원만 사용하도록 만들 수 있다

<img width="995" alt="image" src="https://github.com/dik654/Kubernetes_study/assets/33992354/e69dbe5b-5c4c-4b8b-aba9-9929d2bd2bfa">

여담으로 쿠버네티스를 설치할 때 swap을 끄는 이유가 Cgroup과 관련이 있을 것으로 생각되는데,
https://kgw7401.tistory.com/50 <br/>
swap memory는 memory 용량이 부족할 때 하드 디스크의 일부 공간을 메모리처럼 사용하므로<br/>
Cgroup에서 파일 시스템으로 관리하는 cpu, memory정보가 swap memory으로 생긴 추가 memory 때문에 괴리가 생겨<br/>
Cgroup이 제대로 동작하지 않아서일 것이라 생각된다
