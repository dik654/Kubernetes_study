# 마이크로 서비스란? 

마이크로서비스는 도메인에 따라 모델링된 독립적 릴리스가 가능한 서비스이다.
마이크로서비스라는 작은 블록으로 기능을 캡슐화하고 네트워크를 통해 서비스들간 통신하여 복잡한 시스템을 구축할 수 있다
외부에서보면 마이크로서비스는 공개된 앤드포인트 이외에는 공개되지않은 블랙박스로 생각한다. 이는 최대한 많은 정보를 감추고 최소한을 외부 인터페이스로 노출하는 정보 은닉이라는 특성을 갖게하고, 이러한 특징 때문에 대부분의 상황에서 공유 DB를 지양하고 자체 DB를 캡슐화한다
정보 은닉은 변경에 있어 어려운 것과 쉬운 것을 명확히 구분해주는데, 외부로 공개된 인터페이스가 하위호환성을 깨뜨리지 않는 것들은 쉽게 변경할 수 있고, 그 반대되는 것들은 어렵다는 것이다.
이러한 특성 덕분에 시스템 결합은 느슨해지고, 응집력은 강해진다
<br/><br/><br/><br/>

# 마이크로서비스 핵심 개념

## 독립적 배포성
의존해야할 다른 마이크로서비스를 추가배포하지않아도 하나의 마이크로서비스는 단독으로 변경, 배포, 릴리스가 가능해야한다(느슨한 결합)

## 비지니스 도메인 중심 모델링
DDD같은 도메인 중심의 설계를 이용하여 서비스 경계를 정의하여, 새로운 기능이나 재결합을 하기에 더 간단하다.
기능 변경에 있어서 둘 이상의 마이크로서비스를 변경해야할 경우 모놀리스나 단일 서비스에서 변경하는 것보다 훨씬 많은 작업이 필요하기 때문이다
기존 프론트, 백엔드, DB 3계층 아키텍처의 경우 기능 변경에 있어 3계층이 모두 변경되야하는데, 서비스를 비지니스 기능 단위로 만들면 비지니스 기능을 최대한 효율적으로 변경하도록 아키텍처를 배치할 수 있다

## 크기
마이크로서비스는 코드라인이 중요한 것이 아니다
중요한 점은 2가지이다
1. 얼마나 많은 마이크로서비스를 처리할 수 있는가?
2. 어떻게 경계를 정의해야하는가?

## 유연성
마이크로서비스는 비용이 들기에 비용을 항상 따져야한다.
마이크로 서비스가 늘어날수록 유연성은 커지고 개발 난이도는 올라가므로 모놀리스 구조에서 점진적으로 필요에 따라 변경하는 것이 좋다
<br/><br/><br/><br/>

# 모놀리스 아키텍처

## 단일 프로세스형 모놀리스
모든 코드가 하나의 프로세스로 배포되는 시스템으로, 소규모 조직에 적합하다

## 모듈식 모놀리스
모든 코드가 하나의 프로세스로 배포되는 것은 동일하지만, 각 기능들을 모듈로 분해하여 독립적으로 작업할 수 있도록하는 방식이다
다만 공유 DB를 사용하는 경우, 추후에 DB를 분해하는 것이 쉽지않다

## 분산형 모놀리스
분산형 모놀리스는 여러 서비스로 구성된 시스템이지만 전체 시스템을 함께 배포해야하는 방식이다
보통 분산 시스템과 단일 프로세스형 모놀리스의 단점을 모두 갖고있지만, 장점은 그렇지 못하는 경우가 많다고한다

## 장/단점
모놀리스 구조의 경우, 3계층 아키텍처로 이루어진 경우가 많기에 코드를 변경함에 있어서 소유권과 결정권에 충돌이 생기는 경우가 많다
하지만 서비스 간 통신이나 코드 재사용에 있어서 네트워크를 사용할 필요가 없어 개발과정이 상대적으로 가벼운 편이다
<br/><br/><br/><br/>

# 마이크로서비스 장점

## 기술 이질성
모놀리식 앱에서 새로운 언어, DB, 프레임워크는 시스템의 많은 부분에 영향을 미칠 수 있다
마이크로서비스에서 내부는 블랙박스이므로 새로운 기술들을 도입하는 부분에 있어 부담이 적다

## 견고성
모놀리식 서비스의 경우 하나가 고장나면 모두 정지하지만,
마이크로서비스에서는 구성 요소 하나가 고장날 수 있지만, 그 고장이 연쇄적으로 발생하지 않는 한 다른 시스템들은 계속 동작할 수 있다

## 확장성
대규모 모놀리식 서비스에서 어느 한 부분의 성능 제약이 있어 확장이 제한된다면, 모든 부분을 확장해야한다
마이크로서비스에서는 확장이 필요한 서비스만 확장할 수 있다

## 배포 용이성
모놀리식 앱에서는 단 한 줄만 변경되더라도 전체 앱을 배포해야하기에 매우 부담스럽다
마이크로서비스에서는 하나의 서비스만 독립적으로 배포할 수 있어 빠르게 배포해보고 빠르게 수정이 가능하다

## 조합성
하나의 마이크로서비스를 다양한 목적, 방식으로 재사용이 가능하다

# 마이크로서비스의 어려운점

## 개발자 경험
마이크로서비스가 10개, 20개... 점점 늘어난다면 로컬에서 모두 실행이 어려워질 것이다

## 기술 과다
다양한 언어, DB, 런타임을 선택할 경우 모든 새로운 기술이 개발에 대한 생각을 어떻게 바꾸는지 이해하는데 있어 어려움이 생길 수 있다

## 비용
모놀리스 구조일 때보다 더 많은 프로세스, 네트워크, 스토리지, 소프트웨어가 필요하게되어 단기적으로 비용이 커질 가능성이 높고,
새로운 개념을 배우고 적용하는 기간 때문에 단기적으로 조직의 속도가 느려질 수 있다

## 리포팅
데이터가 논리적으로 분리된 여러 스키마에 분산되어 있기에 모놀리스보다 리포팅이 더 어렵다

## 보안
데이터가 서비스 사이 네트워크를 통해 이동하므로, 중간에 탈취되거나 중간자 공격을 당할 수 있다

## 테스트
모놀리스에 비해 E2E 테스트 범위가 늘어나고, 네트워크 등의 문제로 테스트가 실패하는 false nagative를 대비해야한다

## 지연 시간
마이크로서비스에서 데이터를 직렬화/역직렬화를 하여 네트워크를 통해 처리하기에 지연 시간이 생긴다

## 데이터 일관성
마이크로서비스로 이동하면서 DB도 분리되는 경우 데이터의 정합성, 일관성에 대한 잠재적 문제가 생긴다

# 언제 마이크로서비스를 사용해야하는가?

## 적합한 곳
- 더 많은 개발자가 서로 방해하지 않고 동일 시스템에서 작업하기 위해
- SaaS 앱

## 적합하지 않은 곳
- 새 제품을 만드는 스타트업
- 마이크로서비스 배포, 관리도 부담스러운 소규모 팀
- 고객이 배포하고 관리할 소프트웨어를 만드는 조직
